var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{u(r.next(e))}catch(t){a(t)}}function s(e){try{u(r["throw"](e))}catch(t){a(t)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}u((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,a&&(o=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(a,n[1])).done)return o;switch(a=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,a=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(o=u.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){u.label=n[1];break}if(6===n[0]&&u.label<o[1]){u.label=o[1],o=n;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(n);break}o[2]&&u.ops.pop(),u.trys.pop();continue}n=t.call(e,u)}catch(r){n=[6,r],a=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,a,o,s,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},Uilt=function(){function e(){}return e.getOption=function(e){if(window.location){var t=location.search;if(""==t)return"";t=t.slice(1);for(var n=t.split("&"),r=n.length,i=0;r>i;i++){var a=n[i],o=a.split("=");if(o[0]==e)return o[1]}}return""},e}();__reflect(Uilt.prototype,"Uilt");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function r(r){t.call(n,r,e)}if(RES.hasRes(e)){var i=RES.getRes(e);i?r(i):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var ScreenManager=function(){function e(t){"ios"==egret.Capabilities.os.toLowerCase()&&egret.Capabilities.isMobile&&(e._baseUI=t,window.addEventListener("resize",this.windowResizeHandler),this.windowResizeHandler(null))}return e.prototype.windowResizeHandler=function(t){return window.innerHeight>window.innerWidth?(e._baseUI.scaleY=1,void window.scrollTo(0,0)):window.innerHeight>=document.documentElement.clientHeight?(e._baseUI.scaleY=1,void window.scrollTo(0,0)):(e._baseUI.scaleY=window.innerHeight/document.documentElement.clientHeight,void window.scrollTo(0,0))},e}();__reflect(ScreenManager.prototype,"ScreenManager");var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return WindowScreen.WIDTH=this.stage.stageWidth,WindowScreen.HEIGHT=this.stage.$stageHeight,[4,this.loadResource()];case 1:return t.sent(),[4,RES.getResAsync("questions_json")];case 2:return e=t.sent(),this.createGameScene(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return n.sent(),this.stage.removeChild(e),[3,5];case 4:return t=n.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var r=new eui.Theme("resource/default.thm.json",e.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){var e=(new GameManger,new SoundManger,StartScreen.getInstance());this.addChild(e)},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t},t.prototype.onButtonClick=function(e){var t=new eui.Panel;t.title="Title",t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,r){function i(e){t.call(r,e)}function a(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),n.call(r))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(r,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var s=e.split("/");s.pop();var u=s.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(r,generateJSON.paths[e])},this):RES.getResByUrl(u,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){t.call(r,generateJSON.paths[e])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var RANDOM_QUESTION_NUM=6,UserData=function(){function e(){this.userInfo={name:"",avater:"",token:"",isAuthor:!1,id:""},this.select="",this.score=0}return e}();__reflect(UserData.prototype,"UserData");var QuestionData=function(){function e(){this.title="",this.right="",this.range="",this.level="",this.options=[]}return e}();__reflect(QuestionData.prototype,"QuestionData");var GameManger=function(){function e(){this.setDefultAIinfo();var t=Uilt.getOption("token")||egret.localStorage.getItem("token");if(t){egret.localStorage.setItem("token",t),e.playerData.userInfo.isAuthor=!0;var n=Uilt.getOption("share_id");this.getUserInfo(t,n).then(function(t){var r=t.data.oneself;if(e.playerData.userInfo.name=r.nickname,e.playerData.userInfo.avater=r.avatar,e.playerData.userInfo.id=r.id,n){var i=t.data.oneself;e.playerData.userInfo.name=i.nickname,e.playerData.userInfo.avater=i.avatar,e.AIData.userInfo.id=i.id}})["catch"](function(e){console.error(e),alert("获取用户信息失败")})}e.questions=RES.getRes("questions_json");for(var r=0;r!=e.questions.length;)e.randomNums.push(r++)}return e.prototype.setDefultAIinfo=function(){e.AIData.userInfo.name="小安",e.AIData.userInfo.avater="https://h5.kkts.kidskiss.com.cn/element/RcPXwxAew3uKe6rAqBH3MNpFAFNVAyesJWBNcBxT.png"},e.prototype.getUserInfo=function(e,t){var n=this;return new Promise(function(r,i){var a=new egret.HttpRequest;a.responseType=egret.HttpResponseType.TEXT,a.open("http://315xbapi.sinmore.vip/api/pkTop?token="+e+(t?"&rival_id="+t:""),egret.HttpMethod.GET),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(),a.addEventListener(egret.Event.COMPLETE,function(e){var t=e.currentTarget,n=JSON.parse(t.response);console.log(n),0==n.error_code?r(n):i(n.error_msg)},n)})},e.resetGameState=function(){e.currentQuestionIndex=0,e.playerData.score=0,this.resetSelectedState()},e.resetSelectedState=function(){e.AIData.select="",e.playerData.select=""},e.getRandoQuestions=function(){for(var t=[],n=0;RANDOM_QUESTION_NUM>n;n++){var r=Math.floor(Math.random()*(e.randomNums.length-1)),i=e.randomNums[r];t.push(e.randomNums.splice(r,1)[0]),e.randomQuestions.push(e.questions[i])}t.sort().forEach(function(t){e.randomNums.splice(t,0,t)})},e.AIControl=function(e){var t=this,n=this,r=Math.floor(3*Math.random()),i=Math.floor(6*Math.random()),a=setTimeout(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){return e.call(n,r,"ai"),clearTimeout(a),[2]})})},1e3*i)},e.recordScore=function(t){var n=(5==e.currentQuestionIndex?300:200)/10,r=10-t;console.log(r,"replyTime"),2>=r?e.playerData.score+=10*n:4>=r?e.playerData.score+=8*n:6>=r?e.playerData.score+=6*n:4>=r?e.playerData.score+=4*n:e.playerData.score+=2*n,console.log(e.playerData.score)},e.questions=[],e.randomNums=[],e.randomQuestions=[],e.gameTime=10,e.playerData=new UserData,e.AIData=new UserData,e.currentQuestionIndex=0,e}();__reflect(GameManger.prototype,"GameManger");var isMusic=!0,SoundManger=function(){function e(){e.errorSound=this.loadSound("resource/sound/error.mp3"),egret.localStorage.getItem("music_play")?isMusic="1"==egret.localStorage.getItem("music_play")?!0:!1:egret.localStorage.setItem("music_play","1")}return Object.defineProperty(e,"isMusic",{get:function(){return isMusic},set:function(e){isMusic=e,egret.localStorage.setItem("music_play",e?"1":"0")},enumerable:!0,configurable:!0}),e.prototype.loadSound=function(e){var t=new egret.Sound;return t.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){console.log("loaded error!")},this),t.load(e),t},e.playErrorSound=function(){e.isMusic&&this.errorSound.play(0,1)},e}();__reflect(SoundManger.prototype,"SoundManger");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var WindowScreen=function(){function e(){}return e}();__reflect(WindowScreen.prototype,"WindowScreen");var WxSDK=function(){function e(){var e=new BodyConfig;e.appId="此处填写公共平台appID，未认证的ID将不能使用自定义分享等接口，请联系微信官方获取",e.debug=!0,e.jsApiList=["checkJsApi","onMenuShareAppMessage","onMenuShareTimeline"],wx&&(wx.config(e),wx.ready(function(){var e="标题：用户昵称邀请您对战~",t="描述：315消保王者挑战赛，金融消费者素质提升计划",n=location.href;GameManger.playerData.userInfo.id&&n+"?=share_id="+GameManger.playerData.userInfo.id;var r=new BodyMenuShareAppMessage;r.title=e,r.desc=t,r.link=n,wx.onMenuShareTimeline(r);var i=new BodyMenuShareTimeline;i.title=e,i.link=n,wx.onMenuShareTimeline(i)}))}return e.prototype.getWxConfig=function(){},e}();__reflect(WxSDK.prototype,"WxSDK");var QUESTION_COLOR=8947848,ANSWER_MAP={A:0,B:1,C:2,D:3},NUM_MAP=["一","二","三","四","五","六"],SELECT_COLORS=[3963127,4494227,6998151,15487831],Timeout=function(){function e(){}return e.restTimeout=function(t){clearTimeout(e.timer),e.time=10,t.text=e.time},e.startTimeOut=function(t,n){e.timer=setTimeout(function(){if(0!==e.time){if(t.text=--e.time+"",0===e.time)return void(n&&n());e.startTimeOut(t,n)}},1e3)},e.stopTimeOut=function(){clearTimeout(e.timer)},e.timer=null,e.time=10,e}();__reflect(Timeout.prototype,"Timeout");var GameScreen=function(e){function t(){var t=e.call(this)||this;return t.answerButtons=[],t.answerButtonsText=[],t.answerButtonsGroup=[],t.playerAnswerRightTipe=[],t.AIAnswerRightTipe=[],t.playerAnswerErrorTipe=[],t.AIAnswerErrorTipe=[],t.playerSelected=!1,t.playSelectTime=0,t.selectedNum=0,t.timeoutHandle=function(){var e=GameManger.randomQuestions[GameManger.currentQuestionIndex];t.selectAnswer(ANSWER_MAP[e.right],"auto")},t}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),document.getElementsByTagName("html")[0].style.background="yellow",t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.init()},t.prototype.init=function(){var e=this;RES.getResAsync("bg02_png").then(function(t){return e.bg_img.source=t}),this.setPkInfo(),this.startCreateScene()},t.prototype.setPkInfo=function(){this.ai_name.text=GameManger.AIData.userInfo.name,this.player_name.text="玩家"},t.prototype.startCreateScene=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.initAnswerButton(),this.transtionsScreen=this.createTranstionsScreen(),t.playGame(),[2]})})},t.playGame=function(){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(r){switch(r.label){case 0:return e=t.shared,GameManger.getRandoQuestions(),Timeout.restTimeout(e.timeout),e.playerSelected=!1,e.playSelectTime=0,e.selectedNum=0,n=GameManger.randomQuestions[GameManger.currentQuestionIndex],e.resetQuestionScreen(n),GameManger.resetGameState(),[4,e.showTranstionsScreen("开始")];case 1:return r.sent(),[4,e.showTranstionsScreen("第一题")];case 2:return r.sent(),[4,e.showQuestionScreen()];case 3:return r.sent(),Timeout.startTimeOut(e.timeout,e.timeoutHandle),GameManger.AIControl.call(e,e.selectAnswer),[2]}})})},t.prototype.initAnswerButton=function(){for(var e=1;3>=e;e++)this["answer_button_group_0"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectAnswer.bind(this,e-1,"player"),this),this.playerAnswerRightTipe.push(this["right_icon_player_0"+e]),this.AIAnswerRightTipe.push(this["right_icon_ai_0"+e]),this.playerAnswerErrorTipe.push(this["error_icon_player_0"+e]),this.AIAnswerErrorTipe.push(this["error_icon_ai_0"+e]),this.answerButtonsGroup.push(this["answer_button_group_0"+e]),this.answerButtons.push(this["answer_button_0"+e]),this.answerButtonsText.push(this["answer_button_text_0"+e])},t.prototype.createTranstionsScreen=function(){var e=new eui.Group;e.width=WindowScreen.WIDTH,e.height=500;var t=1;e.top=150;var n=new eui.Label;return n.name="questionNumberText",n.text="第"+t+"题",n.textColor=0,e.addChild(n),n.size=40,n.bold=!0,n.width=WindowScreen.WIDTH,n.height=500,n.verticalAlign=egret.VerticalAlign.MIDDLE,n.textAlign=egret.HorizontalAlign.CENTER,e},t.prototype.showTranstionsScreen=function(e){var t=this,n=this.transtionsScreen.getChildByName("questionNumberText");n.text=e,this.addChild(this.transtionsScreen);var r=egret.Tween.get(n);return new Promise(function(e){r.to({size:60},500,egret.Ease.backInOut).to({alpha:0},500,egret.Ease.backInOut).call(function(){n.size=40,n.alpha=1,t.removeChild(t.transtionsScreen),e()})})},t.prototype.showQuestionScreen=function(){var e=this;return new Promise(function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r,i=this;return __generator(this,function(a){switch(a.label){case 0:this.addChild(this.question_screen),e=[this.question_title,this.answer_group,this.question_tipe],n=0,r=this.showQuestionAmin(e[n]),a.label=1;case 1:return n===e.length-1?[3,3]:[4,r.then(function(){return r=i.showQuestionAmin(e[++n])})];case 2:return a.sent(),[3,1];case 3:return t(),[2]}})})})},t.prototype.showQuestionAmin=function(e){var t=new Promise(function(t){var n=egret.Tween.get(e);n.to({alpha:1},300,egret.Ease.circIn),n.call(function(){return t()})});return t},t.prototype.hideQuestionScreen=function(){var e=this;return new Promise(function(t){var n=[e.question_title,e.answer_group,e.question_tipe];n.forEach(function(e){var t=egret.Tween.get(e);t.wait(800).to({alpha:0},500,egret.Ease.circOut)});var r=setTimeout(function(){t(),clearTimeout(r)},1500)})},t.prototype.selectAnswer=function(e,t){return void 0===t&&(t="player"),__awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(a){switch(a.label){case 0:return"player"==t&&this.playerSelected?[2,!1]:(++this.selectedNum,n=this[""+e],r=this.answerButtons[e],i=this.answerButtonsText[e],"player"==t&&(i.textColor=SELECT_COLORS[0],r.strokeColor=SELECT_COLORS[0],this.playerSelected=!0,this.playSelectTime=Timeout.time,GameManger.playerData.select=e),"ai"==t&&(i.textColor=SELECT_COLORS[1],r.strokeColor=SELECT_COLORS[1],GameManger.AIData.select=e),[4,this.tapAnswerAmin(r)]);case 1:return a.sent(),[4,this.checkIsNext()];case 2:return a.sent(),[2]}})})},t.prototype.tapAnswerAmin=function(e){return new Promise(function(t){var n=egret.Tween.get(e);n.to({scaleX:1.02,scaleY:1.02},200,egret.Ease.backInOut).to({scaleX:1,scaleY:1},200,egret.Ease.backInOut).wait(500).call(t)})},t.prototype.showNextQuestion=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return++GameManger.currentQuestionIndex,e=GameManger.randomQuestions[GameManger.currentQuestionIndex],[4,this.hideQuestionScreen()];case 1:return t.sent(),this.resetQuestionScreen(e),Timeout.restTimeout(this.timeout),GameManger.resetSelectedState(),this.playerSelected=!1,[4,this.showTranstionsScreen(5==GameManger.currentQuestionIndex?"最后一题":"第"+NUM_MAP[GameManger.currentQuestionIndex]+"题")];case 2:return t.sent(),[4,this.showQuestionScreen()];case 3:return t.sent(),Timeout.startTimeOut(this.timeout,this.timeoutHandle),GameManger.AIControl.call(this,this.selectAnswer),[2]}})})},t.prototype.resetQuestionScreen=function(e){var t=this,n=[GameManger.playerData.select,GameManger.AIData.select];n.filter(function(e){return""!==e}).forEach(function(e){t.playerAnswerRightTipe[e].alpha=0,t.AIAnswerRightTipe[e].alpha=0,t.playerAnswerErrorTipe[e].alpha=0,t.AIAnswerErrorTipe[e].alpha=0});var r=e.title,i=e.range,a=e.options;this.question_title.text=r,this.question_tipe.text=i,a.forEach(function(e,n){t.answerButtonsText[n].text=e,t.answerButtonsText[n].textColor=0,t.answerButtons[n].strokeColor=13421772})},t.prototype.checkIsNext=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(2===this.selectedNum){if(this.checkAnswer(),this.selectedNum=0,5==GameManger.currentQuestionIndex)return this.finishGame(),[2];this.showNextQuestion()}return[2]})})},t.prototype.finishGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return Timeout.stopTimeOut(),[4,this.hideQuestionScreen()];case 1:return e.sent(),[4,this.showTranstionsScreen("答题结束")];case 2:return e.sent(),this.parent.addChild(ResultScreen.getInstance()),ResultScreen.getResult(GameManger.playerData.score),this.parent.removeChild(this),[2]}})})},t.prototype.checkAnswer=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,a=this;return __generator(this,function(o){return e=["A","B","C","D"],t=GameManger.randomQuestions[GameManger.currentQuestionIndex],n=e.indexOf(t.right),r=!1,i=[GameManger.playerData.select,GameManger.AIData.select],i.filter(function(e){return""!==e}).forEach(function(e,t){+e==n?(r=!0,a.answerButtonsText[e].textColor=SELECT_COLORS[1],a.answerButtons[e].strokeColor=SELECT_COLORS[1],GameManger.playerData.select==e&&0==t&&(GameManger.recordScore(a.playSelectTime),a.playerAnswerRightTipe[e].alpha=1),GameManger.AIData.select==e&&(a.AIAnswerRightTipe[e].alpha=1)):(a.answerButtonsText[e].textColor=SELECT_COLORS[3],a.answerButtons[e].strokeColor=SELECT_COLORS[3],GameManger.playerData.select==e&&(a.playerAnswerErrorTipe[e].alpha=1,SoundManger.playErrorSound(),a.errorAmin()),GameManger.AIData.select==e&&(a.AIAnswerErrorTipe[e].alpha=1))}),r||(this.answerButtonsText[n].textColor=SELECT_COLORS[1],this.answerButtons[n].strokeColor=SELECT_COLORS[1]),[2]})})},t.prototype.errorAmin=function(){var e=this;return new Promise(function(t){var n=egret.Tween.get(e);n.to({x:-10},100,egret.Ease.cubicInOut).to({x:10},100,egret.Ease.cubicInOut).to({x:-10},100,egret.Ease.cubicInOut).to({x:0},100,egret.Ease.cubicInOut).wait(500).call(t)})},t}(eui.Component);__reflect(GameScreen.prototype,"GameScreen",["eui.UIComponent","egret.DisplayObject"]);var RankScreen=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.childrenCreated=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,a,o,s=this;return __generator(this,function(u){switch(u.label){case 0:return e.prototype.childrenCreated.call(this),this.init(),t=this,[4,this.getRankData()];case 1:for(t.rank_data=u.sent(),n=0,r=["first","second","third"],i=0;3>i;i++)this.rank_data[0]&&(this[r[n]+"_name"].text=this.getChar(this.rank_data[0].nickname,10),this[r[n]+"_score"].text=this.rank_data[0].score,a=new egret.ImageLoader,a.crossOrigin="anonymous",a.load(this.rank_data[0].avatar),a.once(egret.Event.COMPLETE,function(e){if(e.currentTarget.data){egret.log("加载头像成功: "+e.currentTarget.data);var t=new egret.Texture;t.bitmapData=e.currentTarget.data,s[r[n]+"_avatar"].source=t}},this),++n,this.rank_data.shift());return this.rank_data.length&&(o=3,this.rank_data.forEach(function(e,t){s.rank_list_group.addChild(s.createRankListItem(e,++o))})),[2]}})})},t.prototype.init=function(){var e=new eui.VerticalLayout;e.horizontalAlign=egret.HorizontalAlign.CENTER,e.gap=50,e.paddingTop=0,e.paddingBottom=50,this.rank_list_group.layout=e},t.prototype.getChar=function(e,t){var n=new egret.ByteArray;return n.writeUTFBytes(e),n.length<t?e:(n.position=0,n.readUTFBytes(t)+"...")},t.prototype.createRankListItem=function(e,t){console.log("create",e,t);var n=new eui.Group;n.width=500,n.height=80;var r=(new eui.HorizontalLayout,new eui.Label);r.textColor=3355443,r.text=10>t?"0"+t:t,r.height=80,r.size=29,r.verticalAlign=egret.VerticalAlign.MIDDLE,n.addChild(r);var i=new eui.Group,a=new eui.Rect;a.width=90,a.height=90,a.ellipseWidth=90,a.ellipseWidth=90,i.addChild(a);var o=new eui.Image,s=new egret.ImageLoader;s.crossOrigin="anonymous",s.load(e.avatar),s.once(egret.Event.COMPLETE,function(e){if(e.currentTarget.data){egret.log("加载头像成功: "+e.currentTarget.data);var t=new egret.Texture;t.bitmapData=e.currentTarget.data,o.source=t}},this),o.width=90,o.height=90,o.mask=a,i.addChild(o);var u=new eui.Group;u.width=90,u.height=30,u.x=0,u.y=-20;var c=new eui.Image;c.width=90,c.height=30,c.x=0,c.y=90,c.source=RES.getRes("t1"),u.addChild(c),i.addChild(u),i.x=50,n.addChild(i);var l=new eui.Label;l.text=e.nickname,l.textColor=3355443,l.size=25,l.x=170,l.height=80,l.verticalAlign=egret.VerticalAlign.MIDDLE,n.addChild(l);var h=new eui.Label;return h.text=e.score+"分",h.textColor=16760873,h.size=29,h.width=500,h.height=80,h.verticalAlign=egret.VerticalAlign.MIDDLE,h.x=0,h.textAlign=egret.HorizontalAlign.RIGHT,n.addChild(h),n},t.prototype.getRankData=function(){var e=this;return new Promise(function(t){var n=new egret.HttpRequest;n.responseType=egret.HttpResponseType.TEXT,n.open("http://315xbapi.sinmore.vip/api/ranking",egret.HttpMethod.GET),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(),n.addEventListener(egret.Event.COMPLETE,function(e){var n=e.currentTarget,r=JSON.parse(n.response);t(r.data)},e)})},t}(eui.Component);__reflect(RankScreen.prototype,"RankScreen",["eui.UIComponent","egret.DisplayObject"]);var ResultScreen=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.again_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.againGame,this),this.share_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showShareMask,this)},t.getResult=function(e){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=t.shared,r=new egret.TextField,r.width=480,r.x=0,r.y=0,r.textColor=0,r.size=20,r.fontFamily="微软雅黑",r.textAlign=egret.HorizontalAlign.CENTER,r.textFlow=[{text:"加载成绩中...",style:{size:26}}],n.result_text.addChild(r),r.textFlow=[{text:"答完题啦！本次得分",style:{size:26}},{text:" "+e+" ",style:{textColor:16238172,size:38}}],[2]})})},t.prototype.fetchResult=function(e){var t=this;return new Promise(function(e){var n=new egret.HttpRequest;n.responseType=egret.HttpResponseType.TEXT,n.open("http://315xbapi.sinmore.vip/api/getResult",egret.HttpMethod.GET),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(),n.addEventListener(egret.Event.COMPLETE,function(t){var n=t.currentTarget,r=JSON.parse(n.response);e(r)},t)})},t.prototype.showShareMask=function(){var e=this.parent;e.addChildAt(ShareGuideScreen.getInstance(),999)},t.prototype.againGame=function(){this.parent.addChild(GameScreen.getInstance()),this.parent.removeChild(this),GameScreen.playGame()},t}(eui.Component);__reflect(ResultScreen.prototype,"ResultScreen",["eui.UIComponent","egret.DisplayObject"]);var ShareGuideScreen=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.parent.removeChild(t)},this)},t}(eui.Component);__reflect(ShareGuideScreen.prototype,"ShareGuideScreen",["eui.UIComponent","egret.DisplayObject"]);var StartScreen=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.init()},t.prototype.init=function(){t.getInstance(),this.playMusicIcon=RES.getRes("music_open"),this.closeMusicIcon=RES.getRes("music_close"),SoundManger.isMusic&&(this.music_btn.source=SoundManger.isMusic?this.playMusicIcon:this.closeMusicIcon),this.start_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startGame,this),this.rank_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showRank,this),this.music_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.controlMusic,this),this.share_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showShareMask,this)},t.prototype.controlMusic=function(){console.log(SoundManger.isMusic,"isMusic"),SoundManger.isMusic=!SoundManger.isMusic,this.music_btn.source=SoundManger.isMusic?this.playMusicIcon:this.closeMusicIcon},t.prototype.startGame=function(){var e=this.parent;e.removeChild(this),e.addChild(GameScreen.getInstance())},t.prototype.showRank=function(){var e=this.parent;e.removeChild(this),e.addChild(RankScreen.getInstance())},t.prototype.showShareMask=function(){var e=this.parent;e.addChildAt(ShareGuideScreen.getInstance(),999)},t}(eui.Component);__reflect(StartScreen.prototype,"StartScreen",["eui.UIComponent","egret.DisplayObject"]);